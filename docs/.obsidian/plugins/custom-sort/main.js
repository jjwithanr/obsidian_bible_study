/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ee=Object.defineProperty;var $r=Object.getOwnPropertyDescriptor;var zr=Object.getOwnPropertyNames;var Ur=Object.prototype.hasOwnProperty;var jr=(t,e)=>{for(var r in e)Ee(t,r,{get:e[r],enumerable:!0})},Zr=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of zr(e))!Ur.call(t,n)&&n!==r&&Ee(t,n,{get:()=>e[n],enumerable:!(o=$r(e,n))||o.enumerable});return t};var Xr=t=>Zr(Ee({},"__esModule",{value:!0}),t);var In={};jr(In,{default:()=>Re});module.exports=Xr(In);var b=require("obsidian");function gt(t,e){let r=Object.keys(e).map(o=>qr(t,o,e[o]));return r.length===1?r[0]:function(){r.forEach(o=>o())}}function qr(t,e,r){let o=t[e],n=t.hasOwnProperty(e),i=r(o);return o&&Object.setPrototypeOf(i,o),Object.setPrototypeOf(s,i),t[e]=s,a;function s(...d){return i===o&&t[e]===s&&a(),i.apply(this,d)}function a(){t[e]===s&&(n?t[e]=o:delete t[e]),i!==o&&(i=o,Object.setPrototypeOf(s,o||Function))}}var ee=require("obsidian");var Le="findStarredFile",Yr="starred",ft=()=>{var e;let t=(e=app==null?void 0:app.internalPlugins)==null?void 0:e.getPluginById(Yr);if(t&&t.enabled&&t.instance){let r=t.instance;if(typeof(r==null?void 0:r[Le])=="function")return r}},Kr=t=>!!t.isRoot,Jr=(t,e)=>t.children.some(r=>!Kr(r)&&e[Le]({path:r.path})),pt=(t,e,r)=>e?!!r[Le]({path:t.path}):Jr(t,r);var bt="getData",ht="obsidian-icon-folder",St=()=>{var e,r,o,n;let t=(r=(e=app==null?void 0:app.plugins)==null?void 0:e.plugins)==null?void 0:r[ht];if(t&&t._loaded&&((n=(o=app==null?void 0:app.plugins)==null?void 0:o.enabledPlugins)!=null&&n.has(ht))){let i=t;if(typeof(i==null?void 0:i[bt])=="function")return i}},xt=(t,e)=>{var n;let r=e[bt](),o=r==null?void 0:r[t.path];return typeof o=="string"?o:typeof(o==null?void 0:o.iconName)=="string"&&(n=o==null?void 0:o.iconName)!=null?n:void 0};var ve=t=>t,$="sort-index-value";function M(t){return t!=null}function ne(t){return(t==null?void 0:t.length)>0?t[t.length-1]:void 0}function G(t){let e=(t!=null?t:"").lastIndexOf("/");return e>=0?t.substring(e+1):t}function z(t){let e=(t!=null?t:"").lastIndexOf("/");return e>0?t.substring(0,e):""}var Qr="{:",eo=":}",to="%parent-folder-name%",ro=Qr+to+eo,Ne=function(t,e){return t&&e?t.replace(ro,e):t},Be=function(t,e){var r;(r=t.groupsShadow)==null||r.forEach(o=>{e&&(o.exactText&&(o.exactText=Ne(o.exactText,e)),o.exactPrefix&&(o.exactPrefix=Ne(o.exactPrefix,e)),o.exactSuffix&&(o.exactSuffix=Ne(o.exactSuffix,e)))})};var v=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!0}).compare,De=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!1}).compare;var I=!0,_=!0,w=!1,L=0,Ft=(t,e)=>{switch(e){case 1:return t.metadataFieldValueSecondary;case 2:return t.metadataFieldValueForDerived;case 3:return t.metadataFieldValueForDerivedSecondary;case 0:default:return t.metadataFieldValue}},C=(t,e,r)=>{let o=e?De:v;return(n,i)=>{let[s,a]=[Ft(n,r),Ft(i,r)];return t&&([s,a]=[a,s]),s&&a?o(s,a):s?-1:a?1:L}},yt=(t,e)=>(r,o)=>(t&&([r,o]=[o,r]),r.bookmarkedIdx&&o.bookmarkedIdx?r.bookmarkedIdx-o.bookmarkedIdx:r.bookmarkedIdx?-1:o.bookmarkedIdx?1:L),Q={[1]:(t,e)=>v(t.sortString,e.sortString),[2]:(t,e)=>De(t.sortString,e.sortString),[3]:(t,e)=>v(e.sortString,t.sortString),[4]:(t,e)=>De(e.sortString,t.sortString),[5]:(t,e)=>t.isFolder&&e.isFolder?v(t.sortString,e.sortString):t.mtime-e.mtime,[6]:(t,e)=>t.mtime-e.mtime,[7]:(t,e)=>t.isFolder&&e.isFolder?v(t.sortString,e.sortString):e.mtime-t.mtime,[8]:(t,e)=>e.mtime-t.mtime,[9]:(t,e)=>t.isFolder&&e.isFolder?v(t.sortString,e.sortString):t.ctime-e.ctime,[10]:(t,e)=>t.ctime-e.ctime,[11]:(t,e)=>t.isFolder&&e.isFolder?v(t.sortString,e.sortString):e.ctime-t.ctime,[12]:(t,e)=>e.ctime-t.ctime,[13]:C(w,!I,0),[14]:C(w,I,0),[15]:C(_,!I,0),[16]:C(_,I,0),[18]:yt(w),[19]:yt(_),[17]:(t,e)=>v(t.sortString,e.sortString)},oo={[13]:C(w,!I,1),[14]:C(w,I,1),[15]:C(_,!I,1),[16]:C(_,I,1)},no={[13]:C(w,!I,2),[14]:C(w,I,2),[15]:C(_,!I,2),[16]:C(_,I,2)},io={[13]:C(w,!I,3),[14]:C(w,I,3),[15]:C(_,!I,3),[16]:C(_,I,3)},ie="alphabetical",Pt="alphabeticalReverse",_e="byModifiedTime",Rt="byModifiedTimeReverse",we="byCreatedTime",Mt="byCreatedTimeReverse",Et=ie,Lt={[ie]:1,[Pt]:3,[_e]:7,[Rt]:5,[we]:11,[Mt]:9},ue={[ie]:(t,e)=>v(t.basename,e.basename),[Pt]:(t,e)=>-ue[ie](t,e),[_e]:(t,e)=>e.stat.mtime-t.stat.mtime,[Rt]:(t,e)=>-ue[_e](t,e),[we]:(t,e)=>e.stat.ctime-t.stat.ctime,[Mt]:(t,e)=>-ue[we](t,e)},ao=t=>{let e=Q[t];return(r,o)=>r.isFolder||o.isFolder?r.isFolder&&!o.isFolder?-1:o.isFolder&&!r.isFolder?1:Q[1](r,o):e(r,o)},so=t=>{let e=ue[t]||Lt[ie];return(r,o)=>{let n=r instanceof ee.TFolder,i=o instanceof ee.TFolder;return n||i?n&&!i?-1:i&&!n?1:v(r.name,o.name):e(r,o)}},K=(t,e,r)=>{var o,n,i,s;if(t===17)return t=(o=Lt[e!=null?e:"alphabetical"])!=null?o:1,ao(t);switch(r){case 1:return(n=oo[t])!=null?n:Q[t];case 2:return(i=no[t])!=null?i:Q[t];case 3:return(s=io[t])!=null?s:Q[t];case 0:default:return Q[t]}},vt=(t,e)=>(o,n)=>{if(o.groupIdx!=null&&n.groupIdx!=null)if(o.groupIdx===n.groupIdx){let i=t.groups[o.groupIdx],s=i!=null&&i.order?K(i.order,e,0)(o,n):L;if(s!==L)return s;let a=i!=null&&i.secondaryOrder?K(i.secondaryOrder,e,1)(o,n):L;if(a!==L)return a;let d=t.defaultOrder?K(t.defaultOrder,e,2)(o,n):L;if(d!==L)return d;let m=t.defaultSecondaryOrder?K(t.defaultSecondaryOrder,e,3)(o,n):L;return m!==L?m:K(1,void 0,4)(o,n)}else return o.groupIdx-n.groupIdx;else return o.groupIdx!==void 0?-1:n.groupIdx!==void 0?1:K(1,e)(o,n)},Nt=t=>!!t.isRoot,le=t=>t===13||t===15||t===14||t===16,Bt=0,Ge=0,J=(t,e)=>{let r=t.regex.exec(e);if(r){let o=t.normalizerFn,n=r[1];return n?[!0,o?o(n):n,r[0]]:[!0,void 0,r[0]]}return[!1,void 0,void 0]},Dt=function(t,e,r){var h,D,Me,lt,ut,ct;let o,n=!1,i,s,a=Nt(t),d=!a,m=t,f=a?t.name:m.basename,u=e.priorityOrder?e.priorityOrder.length:e.groups.length;for(let x=0;x<u&&!n;x++){i=null,o=e.priorityOrder?e.priorityOrder[x]:x;let S=e.groupsShadow?e.groupsShadow[o]:e.groups[o];if(S.foldersOnly&&d||S.filesOnly&&a)continue;let k=S.matchFilenameWithExt?t.name:f;switch(S.type){case 3:if(S.exactPrefix)k.startsWith(S.exactPrefix)&&(n=!0);else{let[y,g]=J(S.regexPrefix,k);n=y,i=g!=null?g:i}break;case 4:if(S.exactSuffix)k.endsWith(S.exactSuffix)&&(n=!0);else{let[y,g]=J(S.regexSuffix,k);n=y,i=g!=null?g:i}break;case 5:if(S.exactPrefix&&S.exactSuffix)k.length>=S.exactPrefix.length+S.exactSuffix.length&&k.startsWith(S.exactPrefix)&&k.endsWith(S.exactSuffix)&&(n=!0);else if(S.exactPrefix||S.exactSuffix){if(S.exactPrefix&&k.startsWith(S.exactPrefix)||S.exactSuffix&&k.endsWith(S.exactSuffix)){let[y,g,Y]=J(S.exactPrefix?S.regexSuffix:S.regexPrefix,k);y&&Y.length+((D=(h=S.exactPrefix)==null?void 0:h.length)!=null?D:0)+((lt=(Me=S.exactSuffix)==null?void 0:Me.length)!=null?lt:0)<=k.length&&(n=!0,i=g!=null?g:i)}}else{let[y,g,Y]=J(S.regexPrefix,k),[T,mt,Hr]=J(S.regexSuffix,k);y&&T&&Y.length+Hr.length<=k.length&&(n=!0,(g||mt)&&(i=(g||"")+(mt||"")||i))}break;case 2:if(S.exactText)k===S.exactText&&(n=!0);else{let[y,g]=J(S.regexPrefix,k);y&&(n=!0,i=g!=null?g:i)}break;case 6:if(S.withMetadataFieldName&&r!=null&&r._mCache){let y=d?t.path:`${t.path}/${t.name}.md`,g=(ut=r._mCache.getCache(y))==null?void 0:ut.frontmatter;(g==null?void 0:g.hasOwnProperty(S.withMetadataFieldName))&&(n=!0)}break;case 7:r!=null&&r.starredPluginInstance&&pt(t,d,r.starredPluginInstance)&&(n=!0);break;case 8:if(r!=null&&r.bookmarksPluginInstance){let y=r==null?void 0:r.bookmarksPluginInstance.determineBookmarkOrder(t.path);y&&(n=!0,s=y)}case 9:if(r!=null&&r.iconFolderPluginInstance){let y=xt(t,r.iconFolderPluginInstance);y&&(S.iconName?n=y===S.iconName:n=!0)}break;case 1:n=!0;break}n&&i&&(S.overrideTitle||(i=i+"//"+t.name))}let l=e.groups.length,c=n?o:l;if(n){let x=e.groups[c].combineWithIdx;x!==void 0&&(c=x)}n||(M(e.outsidersFilesGroupIdx)&&d?(c=e.outsidersFilesGroupIdx,n=!0):M(e.outsidersFoldersGroupIdx)&&a?(c=e.outsidersFoldersGroupIdx,n=!0):M(e.outsidersGroupIdx)&&(c=e.outsidersGroupIdx,n=!0));let p,F,O,A;if(n&&c!==void 0){let x=e.groups[c],S=le(x==null?void 0:x.order),k=le(x==null?void 0:x.secondaryOrder),y=le(e.defaultOrder),g=le(e.defaultSecondaryOrder);if((S||k||y||g)&&r!=null&&r._mCache){let Y=d?t.path:`${t.path}/${t.name}.md`,T=(ct=r._mCache.getCache(Y))==null?void 0:ct.frontmatter;S&&(p=T==null?void 0:T[(x==null?void 0:x.byMetadataField)||(x==null?void 0:x.withMetadataFieldName)||$]),k&&(F=T==null?void 0:T[(x==null?void 0:x.byMetadataFieldSecondary)||(x==null?void 0:x.withMetadataFieldName)||$]),y&&(O=T==null?void 0:T[e.byMetadataField||$]),g&&(A=T==null?void 0:T[e.byMetadataFieldSecondary||$])}}return{groupIdx:c,sortString:i!=null?i:t.name,metadataFieldValue:p,metadataFieldValueSecondary:F,metadataFieldValueForDerived:O,metadataFieldValueForDerivedSecondary:A,isFolder:a,folder:a?t:void 0,path:t.path,ctime:d?m.stat.ctime:Ge,mtime:d?m.stat.mtime:Bt,bookmarkedIdx:s}},kt=new Set([6,8,10,12]),It=(t,e)=>kt.has(t!=null?t:17)||kt.has(e!=null?e:17),Ct=new Set([18,19]),Ot=(t,e)=>Ct.has(t!=null?t:17)||Ct.has(e!=null?e:17),lo=(t,e)=>{let r=Bt,o=Ge;return t.children.forEach(n=>{if(!Nt(n)){let i=n;i.stat.mtime>r&&(r=i.stat.mtime),(i.stat.ctime<o||o===Ge)&&(o=i.stat.ctime)}}),[r,o]},_t=(t,e)=>{let r=Date.now();t.forEach(o=>{if(o.folder){let n=!!(e.defaultOrder&&It(e.defaultOrder,e.defaultSecondaryOrder)),i=!1;if(!n){let s=o.groupIdx;if(s!==void 0){let a=e.groups[s].order,d=e.groups[s].secondaryOrder;i=!!a&&It(a,d)}}(n||i)&&([o.mtime,o.ctime]=lo(o.folder,r))}})},wt=(t,e,r)=>{r&&t.forEach(o=>{let n=!!(e.defaultOrder&&Ot(e.defaultOrder,e.defaultSecondaryOrder)),i=!1;if(!n){let s=o.groupIdx;if(s!==void 0){let a=e.groups[s].order,d=e.groups[s].secondaryOrder;i=Ot(a,d)}}(n||i)&&(o.bookmarkedIdx=r.determineBookmarkOrder(o.path))})},Gt=function(t,e){var a;let r=this.fileExplorer;t.groupsShadow=(a=t.groups)==null?void 0:a.map(d=>Object.assign({},d));let o=this.file.name;Be(t,o);let n=(t.itemsToHide?this.file.children.filter(d=>!t.itemsToHide.has(d.name)):this.file.children).map(d=>Dt(d,t,e));_t(n,t),e.bookmarksPluginInstance&&wt(n,t,e.bookmarksPluginInstance);let i=vt(t,r.sortOrder);n.sort(i);let s=n.map(d=>r.fileItems[d.path]);ee.requireApiVersion&&(0,ee.requireApiVersion)("0.15.0")?this.vChildren.setChildren(s):this.children=s},Wt=function(t,e,r,o,n){var i;if(r){let s={};r.groupsShadow=(i=r.groups)==null?void 0:i.map(u=>Object.assign({},u));let a=t.name;Be(r,a);let d=e.map(u=>(s[u.path]=u,Dt(u,r,o)));_t(d,r),o.bookmarksPluginInstance&&wt(d,r,o.bookmarksPluginInstance);let m=vt(r,n);return d.sort(m),d.map(u=>s[u.path])}else{let s=e.map(d=>d),a=so(n);return s.sort(a),s}};var Ht=" *([MDCLXVI]+)",$t=" *([MDCLXVI]+(?:\\.[MDCLXVI]+)*)",zt=" *([MDCLXVI]+(?:-[MDCLXVI]+)*)",Ut=" *(\\d+)",jt=" *(\\d+(?:\\.\\d+)*)",Zt=" *(\\d+(?:-\\d+)*)",Ve=".",He="-";var Xt="|";var qt="(\\p{Letter}+)",Yt="([a-zA-Z]+)";function ce(t,e){if(t.length<e){let r=e-t.length;return"000000000000000000000000000".substring(0,r)+t}else return t}function me(t="",e,r){return e?`${t.split(e).filter(n=>n).map(n=>ce(n,r!=null?r:8)).join(Xt)}//`:`${ce(t,r!=null?r:8)}//`}function We(t){let e="0iIvVxXlLcCdDmM",r=[0,1,1,5,5,10,10,50,50,100,100,500,500,1e3,1e3];if(t){let o=e.indexOf(t[0]);return o>0?r[o]:0}else return 0}function Vt(t){if(t==null)return"0";let e=We(t.charAt(0)),r,o;for(let n=1;n<t.length;n++)o=We(t.charAt(n)),r=We(t.charAt(n-1)),o<=r?e+=o:e=e-r*2+o;return`${e}`}function ge(t,e,r){return e?`${t.split(e).filter(n=>n).map(n=>ce(Vt(n),r!=null?r:8)).join(Xt)}//`:`${ce(Vt(t),r!=null?r:8)}//`}var uo="/",fe="...",Jt="*",he=`/${fe}`,be=`/${fe}/`,Se=`/${Jt}`,$e=0,Kt=t=>t.split(uo).filter(e=>!!e),pe=class{constructor(e){this.checkIfImplicitSpec=e;this.tree={subtree:{}};this.determinedWildcardRules={};this.addWildcardDefinition=(e,r)=>{let o=Kt(e),n=o.pop();if(n!==Jt&&n!==fe)return null;let i=this.tree;if(o.forEach(s=>{let a=i.subtree[s];if(a)i=a;else{let d={name:s,subtree:{}};i.subtree[s]=d,i=d}}),n===fe){if(i.matchChildren&&!this.checkIfImplicitSpec(i.matchChildren))return{errorMsg:`Duplicate wildcard '${n}' specification for ${e}`};i.matchChildren=r}else{if(i.matchAll&&!this.checkIfImplicitSpec(i.matchAll))return{errorMsg:`Duplicate wildcard '${n}' specification for ${e}`};i.matchAll=r}};this.addRegexpDefinition=(e,r,o,n,i)=>{let s={regexp:e,againstName:r,priority:o||$e,sortingSpec:i,logMatches:!!n};if(this.regexps===void 0||this.regexps.length===0)this.regexps=[s];else{let a=0;for(;a<this.regexps.length&&this.regexps[a].priority>s.priority;)a++;this.regexps.splice(a,0,s)}};this.folderMatch=(e,r)=>{var n,i,s;let o=this.determinedWildcardRules[e];if(o)return(n=o.spec)!=null?n:null;{let a;if(this.regexps){for(let d of this.regexps)if(!(d.againstName&&!r)&&d.regexp.test(d.againstName?r||"":e)){if(a=d.sortingSpec,d.logMatches){let m=d.againstName?`name: ${r}`:`path: ${e}`;console.log(`custom-sort plugin - regexp <${d.regexp.source}> matched folder ${m}`)}break}}if(!a){a=this.tree.matchChildren;let d=this.tree.matchAll,m=Kt(e),f=this.tree,u=m.length-1;for(let l=0;l<=u;l++){let c=m[l],p=f.subtree[c];if(p)f=p,a=(i=p==null?void 0:p.matchChildren)!=null?i:null,d=(s=p.matchAll)!=null?s:d;else{l<u&&(a=d);break}}a=a!=null?a:d}return a?(this.determinedWildcardRules[e]={spec:a},a):(this.determinedWildcardRules[e]={},null)}}}};var hr=(g=>(g[g.SyntaxError=0]="SyntaxError",g[g.SyntaxErrorInGroupSpec=1]="SyntaxErrorInGroupSpec",g[g.DuplicateSortSpecForSameFolder=2]="DuplicateSortSpecForSameFolder",g[g.DuplicateOrderAttr=3]="DuplicateOrderAttr",g[g.DanglingOrderAttr=4]="DanglingOrderAttr",g[g.MissingAttributeValue=5]="MissingAttributeValue",g[g.NoSpaceBetweenAttributeAndValue=6]="NoSpaceBetweenAttributeAndValue",g[g.InvalidAttributeValue=7]="InvalidAttributeValue",g[g.TargetFolderNestedSpec=8]="TargetFolderNestedSpec",g[g.TooManySortingSymbols=9]="TooManySortingSymbols",g[g.SortingSymbolAdjacentToWildcard=10]="SortingSymbolAdjacentToWildcard",g[g.ItemToHideExactNameWithExtRequired=11]="ItemToHideExactNameWithExtRequired",g[g.ItemToHideNoSupportForThreeDots=12]="ItemToHideNoSupportForThreeDots",g[g.DuplicateWildcardSortSpecForSameFolder=13]="DuplicateWildcardSortSpecForSameFolder",g[g.ProblemNoLongerApplicable_StandardObsidianSortAllowedOnlyAtFolderLevel=14]="ProblemNoLongerApplicable_StandardObsidianSortAllowedOnlyAtFolderLevel",g[g.PriorityNotAllowedOnOutsidersGroup=15]="PriorityNotAllowedOnOutsidersGroup",g[g.TooManyPriorityPrefixes=16]="TooManyPriorityPrefixes",g[g.CombiningNotAllowedOnOutsidersGroup=17]="CombiningNotAllowedOnOutsidersGroup",g[g.TooManyCombinePrefixes=18]="TooManyCombinePrefixes",g[g.ModifierPrefixesOnlyOnOutsidersGroup=19]="ModifierPrefixesOnlyOnOutsidersGroup",g[g.OnlyLastCombinedGroupCanSpecifyOrder=20]="OnlyLastCombinedGroupCanSpecifyOrder",g[g.TooManyGroupTypePrefixes=21]="TooManyGroupTypePrefixes",g[g.PriorityPrefixAfterGroupTypePrefix=22]="PriorityPrefixAfterGroupTypePrefix",g[g.CombinePrefixAfterGroupTypePrefix=23]="CombinePrefixAfterGroupTypePrefix",g[g.InlineRegexInPrefixAndSuffix=24]="InlineRegexInPrefixAndSuffix",g[g.DuplicateByNameSortSpecForFolder=25]="DuplicateByNameSortSpecForFolder",g[g.EmptyFolderNameToMatch=26]="EmptyFolderNameToMatch",g[g.InvalidOrEmptyFolderMatchingRegexp=27]="InvalidOrEmptyFolderMatchingRegexp",g))(hr||{}),co=new Set([2,13,20,25,26,27]),E="...",ze=E.length,mo=1,Qt={"a-z":{asc:1,desc:3},"true a-z":{asc:2,desc:4},created:{asc:9,desc:11},modified:{asc:5,desc:7},"advanced modified":{asc:6,desc:8},"advanced created":{asc:10,desc:12},standard:{asc:17,desc:17},"ui selected":{asc:17,desc:17},"by-bookmarks-order":{asc:18,desc:19}},er="by-metadata:",go=",";var Ue="Invalid sorting order",je={[1]:"Invalid target folder specification",[2]:Ue,[3]:Ue,[4]:Ue},Ke="target-folder:",br={"<":2,"\\<":2,">":3,"\\>":3},Je={...br,"order-asc:":2,"order-desc:":3,"sorting:":4},Qe={...br,"order-asc":2,"order-desc":3,asc:2,desc:3},fo={[Ke]:1,"::::":1},tr={...Je,...Qe,...fo},rr=(t,e)=>{let r=Object.keys(e?Qe:Je).find(o=>t==null?void 0:t.toLowerCase().startsWith(o));return r?{lexeme:r,attr:e?Qe[r]:Je[r]}:void 0},po=t=>{let e=Object.keys(Qt).find(r=>t==null?void 0:t.toLowerCase().startsWith(r));return e?{literal:e,order:Qt[e]}:void 0},ho={[1]:13,[3]:15,[2]:14,[4]:16},or=".",bo="/:files",So="/:",xo="/:files.",Fo="/:.",yo="/folders",ko="/",Io="%",Co="/folders:files",Oo="/%",Ao="--%",To="/--hide:",nr="with-metadata:",Po="bookmarked:",Ro="starred:",ir="with-icon:",Ze="//",Mo="/!",Eo="/!!",Lo="/!!!",vo="/!:",No="/!!:",Bo="/!!!:",Sr=1,xr=2,Fr=3,ar={[Mo]:Sr,[Eo]:xr,[Lo]:Fr},sr={[vo]:Sr,[No]:xr,[Bo]:Fr},Do="/+",_o=[Do],dr={[So]:{filesOnly:!0},[bo]:{filesOnly:!0},[Fo]:{filesOnly:!0,filenameWithExt:!0},[xo]:{filesOnly:!0,filenameWithExt:!0},[ko]:{foldersOnly:!0},[yo]:{foldersOnly:!0},[Io]:{},[Co]:{},[Oo]:{},[Ao]:{itemToHide:!0},[To]:{itemToHide:!0}},N=t=>t===E,te=t=>t.indexOf(E)!==-1,yr="\\R+",kr="\\.R+",Ir="\\-R+",Cr="\\d+",Or="\\.d+",Ar="\\-d+",Tr="\\a+",Pr="\\A+",Rr="\\d",Mr="\\[0-9]",Er="\\[0-3]",wo=/[\^$.\-+\[\]{}()|*?=!\\]/g,R=t=>t.replace(wo,"\\$&"),Go=[R(Cr),R(yr),R(Or),R(Ar),R(kr),R(Ir),R(Tr),R(Pr)],j=new RegExp(Go.join("|"),"gi"),Wo=[R(Rr),R(Mr),R(Er)],lr={[Rr]:"\\d",[Mr]:"[0-9]",[Er]:"[0-3]"},ur=new RegExp(Wo.join("|"),"gi"),Vo=t=>(j.lastIndex=0,j.test(t)&&j.test(t)),Ho=t=>(j.lastIndex=0,j.test(t)),$o=t=>(ur.lastIndex=0,t?ur.test(t):!1),zo=t=>{if(t){j.lastIndex=0;let e=j.exec(t);return e?e[0]:null}else return null},Uo=t=>ge(t),jo=t=>ge(t,Ve),Zo=t=>ge(t,He),Xo=t=>me(t),qo=t=>me(t,Ve),Yo=t=>me(t,He);var cr={[yr.toLowerCase()]:{regexpStr:Ht,normalizerFn:Uo,advancedRegexType:4},[kr.toLowerCase()]:{regexpStr:$t,normalizerFn:jo,advancedRegexType:5},[Ir.toLowerCase()]:{regexpStr:zt,normalizerFn:Zo,advancedRegexType:6},[Cr.toLowerCase()]:{regexpStr:Ut,normalizerFn:Xo,advancedRegexType:1},[Or.toLowerCase()]:{regexpStr:jt,normalizerFn:qo,advancedRegexType:2},[Ar.toLowerCase()]:{regexpStr:Zt,normalizerFn:Yo,advancedRegexType:3},[Tr]:{regexpStr:Yt,normalizerFn:ve,advancedRegexType:7},[Pr]:{regexpStr:qt,normalizerFn:ve,advancedRegexType:8,unicodeRegex:!0}};var mr=t=>et(t,1),gr=t=>et(t,2),Ko=t=>et(t,3),et=(t,e)=>{var i;let r=[1,3].includes(e),o=[2,3].includes(e),n=zo(t);if(n){let s=(i=cr[n])!=null?i:cr[n.toLowerCase()],[a,d]=t.split(n),m=r?"^":"",f=o?"$":"",u=Xe(a),l=Xe(d),c=s.unicodeRegex?"ui":"i";return{regexpSpec:{regex:new RegExp(`${m}${u}${s.regexpStr}${l}${f}`,c),normalizerFn:s.normalizerFn},prefix:a,suffix:d,containsAdvancedRegex:s.advancedRegexType}}else if($o(t)){let s=Xe(t),a=r?"^":"",d=o?"$":"";return{regexpSpec:{regex:new RegExp(`${a}${s}${d}`,"i")},prefix:"",suffix:"",containsAdvancedRegex:0}}else return null},Xe=t=>{if(t==="")return t;let e=[];for(;t.length>0;){let r,o;for(let n of Object.keys(lr)){let i=t.indexOf(n);i>=0&&(r!==void 0?i<r&&(r=i,o=n):(r=i,o=n))}if(r!==void 0){if(r>0){let n=t.substring(0,r);e.push(R(n)),t=t.substring(r)}e.push(lr[o]),t=t.substring(o.length)}else e.push(R(t)),t=""}return e.join("")},ae="name:",qe="regexp:",Jo="for-name:",Qo="debug:",en=t=>(t=t!=null?t:{},t.sortSpecByPath||(t.sortSpecByPath={}),t),tn=t=>(t=t!=null?t:{},t.sortSpecByName||(t.sortSpecByName={}),t),fr=t=>(t=t!=null?t:{},t.sortSpecByWildcard||(t.sortSpecByWildcard=new pe(e=>!!e.implicit)),t),xe=t=>({noPrefix:t.prefix.length===0,noSuffix:t.suffix.length===0}),rn=t=>t.endsWith(he)||t.endsWith(be)||t.endsWith(Se);var on=(t,e)=>t.endsWith(Se)?(t=t.slice(0,-Se.length),{path:t.length>0?t:"/",detectedWildcardPriority:e?6:4}):t.endsWith(he)?(t=t.slice(0,-he.length),{path:t.length>0?t:"/",detectedWildcardPriority:e?5:3}):t.endsWith(be)?(t=t.slice(0,-be.length),{path:t.length>0?t:"/",detectedWildcardPriority:e?5:3}):{path:t,detectedWildcardPriority:e?2:1},Ye=(t,e,r)=>t.startsWith(e)?(r(),t.substring(e.length).trim()):t,nn=t=>{let e=!1,r,o,n;do{n=!1,t=Ye(t,Jo,()=>{e=!0,n=!0});for(let i of Object.keys(sr)){let s=!1;if(t=Ye(t,i,()=>{r=sr[i],n=!0,s=!0}),s)break}t=Ye(t,Qo,()=>{o=!0,n=!0})}while(n);if(!t||t.trim()==="")throw new Error("Empty regexp");return{regexp:new RegExp(t),againstName:e,priority:r===void 0?$e:r,log:!!o}},U=class{constructor(e){this.errorMsg=e}},pr=(t,e)=>{var o,n;let r=(n=(o=t.trim().split(" "))==null?void 0:o[0])==null?void 0:n.trim();return r||e},Fe="Sorting symbol must not be directly adjacent to a wildcard because of potential performance problem. An additional explicit separator helps in such case.",ye=class{constructor(e){this.errorLogger=e;this.pathMatchPriorityForPath={};this.problem=(e,r)=>{var a;let o=hr[e],n=(a=this.errorLogger)!=null?a:console.error,i=!co.has(e),s=i?` line ${this.currentEntryLineIdx} of`:"";n(`Sorting specification problem: ${e}:${o} ${r} ---encountered in${s} sorting spec in file ${this.currentSortingSpecContainerFilePath}`),s&&n(`Content of problematic line: "${this.currentEntryLine}"`),this.recentErrorMessage=`File: ${this.currentSortingSpecContainerFilePath}
`+(i?`Specification line #${this.currentEntryLineIdx}: "${this.currentEntryLine}"
`:"")+`Problem: ${e}:${o}
Details: ${r}`,this.problemAlreadyReportedForCurrentLine=!0};this.parseAttribute=e=>{let r=e.trimStart(),o=e.length-r.length,n=r.indexOf(" ");if(n===-1)return null;let i=r.substring(0,n),s=i.toLowerCase(),a=tr[s];if(a){let d=r.substring(n).trim();if(d){let m=this.attrValueValidators[a];if(m){let f=m(d,a,i);if(f instanceof U)this.problem(7,f.errorMsg||je[a]);else{if(f)return{nesting:o,attribute:a,value:f};this.problem(7,je[a])}}else return{nesting:o,attribute:a,value:d}}else this.problem(5,`${je[a]}: "${i}" requires a value to follow`)}return null};this.checkForRiskyAttrSyntaxError=e=>{let r=e.trimStart(),o=r.toLowerCase();for(let n of Object.keys(tr))if(o.startsWith(n)){let i=r.substring(0,n.length);return o.length===n.length?(this.problem(5,`Attribute "${i}" requires a value to follow`),!0):(this.problem(6,`Space required after attribute name "${i}"`),!0)}return!1};this.parseSortingGroupSpec=e=>{let r=e.trim();if(Vo(r))return this.problem(9,"Maximum one sorting symbol allowed per line"),null;if(te(r)){let[l,c]=r.split(E);if(te(l)&&te(c))return this.problem(24,"In current version, inline regex symbols are not allowed both in prefix and suffix."),null}let o,n=0,i,s=0,a,d=0,m=!1,f=!1,u;for(;u===void 0||u;){let l=!1;for(let c of Object.keys(ar))if(r===c||r.startsWith(c+" ")){o=ar[c],n++,u=!0,l=!0,a&&(m=!0),r=r.substring(c.length).trim();break}if(!l){for(let c of _o)if(r===c||r.startsWith(c+" ")){i=!0,s++,u=!0,l=!0,a&&(f=!0),r=r.substring(c.length).trim();break}if(!l){for(let c of Object.keys(dr))if(r===c||r.startsWith(c+" ")){a=dr[c],d++,u=!0,l=!0,r=r.substring(c.length).trim();break}l||(u=!1)}}}return n>1?(this.problem(16,"Only one priority prefix allowed on sorting group"),null):r===""&&o?(this.problem(15,"Priority is not allowed for sorting group with empty match-pattern"),null):s>1?(this.problem(18,"Only one combining prefix allowed on sorting group"),null):r===""&&i?(this.problem(17,"Combining is not allowed for sorting group with empty match-pattern"),null):d>1?(this.problem(21,"Only one sorting group type prefix allowed on sorting group"),null):m?(this.problem(22,"Priority prefix must be used before sorting group type indicator"),null):f?(this.problem(23,"Combining prefix must be used before sorting group type indicator"),null):r===""&&a?a.itemToHide?(this.problem(11,"Exact name with ext of file or folders to hide is required"),null):{outsidersGroup:!0,filesOnly:a.filesOnly,foldersOnly:a.foldersOnly}:a?a.itemToHide?{itemToHide:!0,plainSpec:r,filesOnly:a.filesOnly,foldersOnly:a.foldersOnly}:{plainSpec:r,filesOnly:a.filesOnly,foldersOnly:a.foldersOnly,matchFilenameWithExt:a.filenameWithExt,priority:o!=null?o:void 0,combine:i}:(o||i)&&r!==""?{plainSpec:r,priority:o,combine:i}:null};this.COMBINING_INDICATOR_IDX=-1;this.validateTargetFolderAttrValue=(e,r,o)=>e&&e.trim()||null;this.internalValidateOrderAttrValue=(e,r)=>{e.indexOf(Ze)>=0&&(e=e.substring(0,e.indexOf(Ze)));let o=`${r||""} ${e}`.trim().split(go),n=[];for(let i=0;i<=mo&&i<o.length;i++){let s=i===0?"Primary":"Secondary",a=o[i].trim(),d=!1,m=rr(a);a=m?a.substring(m.lexeme.length).trim():a;let f=po(a);a=f?a.substring(f.literal.length).trim():a;let u=f?rr(a,!0):void 0;a=u?a.substring(u.lexeme.length).trim():a;let l;a.startsWith(er)&&(d=!0,l=a.substring(er.length).trim()||void 0,a="");let c=a.trim()||void 0;if(c)return new U(`${s} sorting order contains unrecognized text: >>> ${c} <<<`);if(m&&u&&m.attr!==4&&u.attr!==4&&m.attr!==u.attr)return new U(`${s} sorting direction ${m.lexeme} and ${u.lexeme} are contradicting`);let p;if(f){switch(m?m.attr:u?u.attr:2){case 2:p=f.order.asc;break;case 3:p=f.order.desc;break;case 4:u?p=u.attr===2?f.order.asc:f.order.desc:p=f.order.asc;break;default:p=void 0}if(d&&(p&&(p=ho[p]),!p))return new U("Sorting by metadata requires one of alphabetical orders")}else return null;n[i]={order:p,byMetadataField:l}}return n};this.validateOrderAttrValue=(e,r,o)=>{var i,s;let n=this.internalValidateOrderAttrValue(e,o);return n?n instanceof U?n:{order:n[0].order,applyToMetadataField:n[0].byMetadataField,secondaryOrder:(i=n[1])==null?void 0:i.order,secondaryApplyToMetadataField:(s=n[1])==null?void 0:s.byMetadataField}:null};this.attrValueValidators={[1]:this.validateTargetFolderAttrValue.bind(this),[2]:this.validateOrderAttrValue.bind(this),[3]:this.validateOrderAttrValue.bind(this),[4]:this.validateOrderAttrValue.bind(this)};this.convertPlainStringSortingGroupSpecToArraySpec=e=>{if(e=e.trim(),N(e))return[E];if(e.startsWith(E))return[E,e.substring(ze)];if(e.endsWith(E))return[e.substring(0,e.length-ze),E];let r=e.indexOf(E);return r>0?[e.substring(0,r),E,e.substring(r+ze)]:[e]};this.consumeParsedSortingGroupSpec=e=>{var r,o,n;if(e.outsidersGroup)return{type:0,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt};if(((r=e.arraySpec)==null?void 0:r.length)===1){let i=e.arraySpec[0];if(N(i))return{type:1,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt};if(i.startsWith(nr)){let s=pr(i.substring(nr.length),$);return{type:6,withMetadataFieldName:s,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}}else{if(i.startsWith(Po))return{type:8,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt};if(i.startsWith(ir)){let s=pr(i.substring(ir.length));return{type:9,iconName:s,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}}else return i.startsWith(Ro)?{type:7,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:{type:2,exactText:i,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}}}if(((o=e.arraySpec)==null?void 0:o.length)===2){let i=e.arraySpec[0],s=e.arraySpec[1];return N(i)&&!N(s)&&!te(s)?{type:4,exactSuffix:s,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:!N(i)&&N(s)&&!te(i)?{type:3,exactPrefix:i,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:(this.problem(1,"three dots occurring more than once and no more text specified"),null)}if(((n=e.arraySpec)==null?void 0:n.length)===3){let i=e.arraySpec[0],s=e.arraySpec[1],a=e.arraySpec[2];return N(s)&&!N(i)&&!N(a)&&!te(a)?{type:5,exactPrefix:i,exactSuffix:a,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:(this.problem(1,"three dots occurring more than once or unrecognized specification of sorting rule"),null)}return this.problem(1,"Unrecognized specification of sorting rule"),null};this.adjustSortingGroupForRegexBasedMatchers=e=>this.adjustSortingGroupForSortingSymbol(e);this.adjustSortingGroupForSortingSymbol=e=>{switch(e.type){case 3:let r=mr(e.exactPrefix);if(r){if(r.containsAdvancedRegex&&xe(r).noSuffix)return this.problem(10,Fe),!1;delete e.exactPrefix,e.regexPrefix=r.regexpSpec}break;case 4:let o=gr(e.exactSuffix);if(o){if(o.containsAdvancedRegex&&xe(o).noPrefix)return this.problem(10,Fe),!1;delete e.exactSuffix,e.regexSuffix=o.regexpSpec}break;case 5:let n=mr(e.exactPrefix);if(n){if(n.containsAdvancedRegex&&xe(n).noSuffix)return this.problem(10,Fe),!1;delete e.exactPrefix,e.regexPrefix=n.regexpSpec}let i=gr(e.exactSuffix);if(i){if(i.containsAdvancedRegex&&xe(i).noPrefix)return this.problem(10,Fe),!1;delete e.exactSuffix,e.regexSuffix=i.regexpSpec}break;case 2:let s=Ko(e.exactText);s&&(delete e.exactText,e.regexPrefix=s.regexpSpec);break}return!0};this.addExpediteGroupInfo=(e,r,o)=>{e.priorityOrder||(e.priorityOrder=[]);let n=!1;for(let i=0;i<e.priorityOrder.length;i++)if(r>e.groups[e.priorityOrder[i]].priority){e.priorityOrder.splice(i,0,o),n=!0;break}n||e.priorityOrder.push(o)}}parseSortSpecFromText(e,r,o,n,i){this.ctx={folderPath:r,specs:[],implicitSpec:i},this.currentEntryLine=null,this.currentEntryLineIdx=null,this.currentSortingSpecContainerFilePath=null,this.problemAlreadyReportedForCurrentLine=null,this.recentErrorMessage=null;let s=!1,a=0;for(let d of e){a++,this.currentEntryLine=d,this.currentEntryLineIdx=a,this.currentSortingSpecContainerFilePath=`${r==="/"?"":r}/${o}`,this.problemAlreadyReportedForCurrentLine=!1;let m=d.trim();if(m===""||m.startsWith(Ze))continue;s=!1;let f=this.parseAttribute(d);if(f)s=this.processParsedSortingAttribute(f),this.ctx.previousValidEntryWasTargetFolderAttr=s&&f.attribute===1;else if(!this.problemAlreadyReportedForCurrentLine&&!this.checkForRiskyAttrSyntaxError(d)){let u=this.parseSortingGroupSpec(d);!this.problemAlreadyReportedForCurrentLine&&!u&&(u={plainSpec:m}),u&&(s=this.processParsedSortGroupSpec(u)),this.ctx.previousValidEntryWasTargetFolderAttr=void 0}if(!s){this.problemAlreadyReportedForCurrentLine||this.problem(0,"Sorting specification line doesn't match any supported syntax");break}}if(s){if(this.ctx.specs.length>0){for(let d of this.ctx.specs)if(!this.postprocessSortSpec(d))return null;for(let d of this.ctx.specs)for(let m=0;m<d.targetFoldersPaths.length;m++){let f=d.targetFoldersPaths[m];if(f.startsWith(ae)){let u=f.substring(ae.length).trim();if(u==="")return this.problem(26,`Empty '${Ke} ${ae}' value`),null;if(n=tn(n),n.sortSpecByName[u])return this.problem(25,`Duplicate '${Ke} ${ae}' definition for the same name <${u}>`),null;n.sortSpecByName[u]=d}}for(let d of this.ctx.specs)for(let m=0;m<d.targetFoldersPaths.length;m++){let f=d.targetFoldersPaths[m];if(f.startsWith(qe)){n=fr(n);let u=f.substring(qe.length).trim();try{let l=nn(u);n.sortSpecByWildcard.addRegexpDefinition(l.regexp,l.againstName,l.priority,l.log,d)}catch(l){return this.problem(27,`Invalid or empty folder regexp expression <${u}>`),null}}else if(rn(f)){n=fr(n);let u=n.sortSpecByWildcard.addWildcardDefinition(f,d);if(u!=null&&u.errorMsg)return this.problem(13,u==null?void 0:u.errorMsg),null}}for(let d of this.ctx.specs)for(let m=0;m<d.targetFoldersPaths.length;m++){let f=d.targetFoldersPaths[m];if(!f.startsWith(ae)&&!f.startsWith(qe)){let{path:u,detectedWildcardPriority:l}=on(f,!!d.implicit),c=!0,p=this.pathMatchPriorityForPath[u];if(p){if(p===1&&l===1)return this.problem(2,`Duplicate sorting spec for folder ${u}`),null;l>=p&&(c=!1)}c&&(n=en(n),n.sortSpecByPath[u]=d,this.pathMatchPriorityForPath[u]=l)}}}return n}else return null}processParsedSortingAttribute(e){if(e.attribute===1)return e.nesting===0?(this.ctx.previousValidEntryWasTargetFolderAttr?this.ctx.currentSpec?this.ctx.currentSpec.targetFoldersPaths.push(e.value):this.ctx.currentSpec=this.putNewSpecForNewTargetFolder(e.value):this.ctx.currentSpec=this.putNewSpecForNewTargetFolder(e.value),!0):(this.problem(8,"Nested (indented) specification of target folder is not allowed"),!1);if(e.attribute===2||e.attribute===3||e.attribute===4){if(e.nesting===0){if(this.ctx.currentSpec||(this.ctx.currentSpec=this.putNewSpecForNewTargetFolder()),this.ctx.currentSpec.defaultOrder){let r=this.ctx.currentSpec.targetFoldersPaths.join(" :: ");return this.problem(3,`Duplicate order specification for folder(s) ${r}`),!1}return this.ctx.currentSpec.defaultOrder=e.value.order,this.ctx.currentSpec.byMetadataField=e.value.applyToMetadataField,this.ctx.currentSpec.defaultSecondaryOrder=e.value.secondaryOrder,this.ctx.currentSpec.byMetadataFieldSecondary=e.value.secondaryApplyToMetadataField,!0}else if(e.nesting>0){if(!this.ctx.currentSpec||!this.ctx.currentSpecGroup)return this.problem(4,"Nested (indented) attribute requires prior sorting group definition"),!1;if(this.ctx.currentSpecGroup.order){let r=this.ctx.currentSpec.targetFoldersPaths.join(" :: ");return this.problem(3,`Duplicate order specification for a sorting rule of folder ${r}`),!1}return this.ctx.currentSpecGroup.order=e.value.order,this.ctx.currentSpecGroup.byMetadataField=e.value.applyToMetadataField,this.ctx.currentSpecGroup.secondaryOrder=e.value.secondaryOrder,this.ctx.currentSpecGroup.byMetadataFieldSecondary=e.value.secondaryApplyToMetadataField,!0}}return!1}processParsedSortGroupSpec(e){if(this.ctx.currentSpec||(this.ctx.currentSpec=this.putNewSpecForNewTargetFolder()),e.plainSpec&&(e.arraySpec=this.convertPlainStringSortingGroupSpecToArraySpec(e.plainSpec),delete e.plainSpec),e.itemToHide)return this.consumeParsedItemToHide(e)?!0:(this.problem(12,"For hiding of file or folder, the exact name with ext is required and no sorting symbols allowed"),!1);{let r=this.consumeParsedSortingGroupSpec(e);if(r)if(this.adjustSortingGroupForSortingSymbol(r))if(this.ctx.currentSpec){let o=this.ctx.currentSpec.groups.push(r)-1;return this.ctx.currentSpecGroup=r,e.priority&&e.priority>0&&(r.priority=e.priority,this.addExpediteGroupInfo(this.ctx.currentSpec,e.priority,o)),e.combine&&(r.combineWithIdx=this.COMBINING_INDICATOR_IDX),!0}else return!1;else return!1;else return!1}}postprocessSortSpec(e){e.outsidersGroupIdx=void 0,e.outsidersFilesGroupIdx=void 0,e.outsidersFoldersGroupIdx=void 0;let r,o;for(let a=0;a<e.groups.length;a++){let d=e.groups[a];d.type===0&&(d.filesOnly?M(e.outsidersFilesGroupIdx)?console.warn(`Ignoring duplicate Outsiders-files sorting group definition in sort spec for folder '${ne(e.targetFoldersPaths)}'`):(e.outsidersFilesGroupIdx=a,o=!0):d.foldersOnly?M(e.outsidersFoldersGroupIdx)?console.warn(`Ignoring duplicate Outsiders-folders sorting group definition in sort spec for folder '${ne(e.targetFoldersPaths)}'`):(e.outsidersFoldersGroupIdx=a,r=!0):M(e.outsidersGroupIdx)?console.warn(`Ignoring duplicate Outsiders sorting group definition in sort spec for folder '${ne(e.targetFoldersPaths)}'`):(e.outsidersGroupIdx=a,r=!0,o=!0))}M(e.outsidersGroupIdx)&&(M(e.outsidersFilesGroupIdx)||M(e.outsidersFoldersGroupIdx))&&console.warn(`Inconsistent Outsiders sorting group definition in sort spec for folder '${ne(e.targetFoldersPaths)}'`),o&&r||(e.outsidersGroupIdx=e.groups.length,e.groups.push({type:0}));let n=!1,i;for(let a=0;a<e.groups.length;a++){let d=e.groups[a];if(d.combineWithIdx===this.COMBINING_INDICATOR_IDX){if(i===void 0)i=a;else if(e.groups[a-1].order)return this.problem(20,"Predecessor group of combined group cannot contain order specification. Put it at the last of group in combined groups"),!1;d.combineWithIdx=i,n=!0}else i=void 0}if(n){let a,d,m,f,u;for(let l=e.groups.length-1;l>=0;l--){let c=e.groups[l];c.combineWithIdx!==void 0?c.combineWithIdx===u?(c.order=a,c.byMetadataField=d,c.secondaryOrder=m,c.byMetadataFieldSecondary=f):(u=c.combineWithIdx,a=c.order,d=c.byMetadataField,m=c.secondaryOrder,f=c.byMetadataFieldSecondary):(u=void 0,a=void 0,d=void 0,m=void 0,f=void 0)}}if(e.priorityOrder)for(let a=0;a<e.groups.length;a++){let d=e.groups[a];d.priority===void 0&&d.type!==0&&e.priorityOrder.push(a)}let s=`${or}/`;return e.targetFoldersPaths.forEach((a,d)=>{a===or?e.targetFoldersPaths[d]=this.ctx.folderPath:a.startsWith(s)&&(e.targetFoldersPaths[d]=`${this.ctx.folderPath}/${a.substring(s.length)}`)}),!0}putNewSpecForNewTargetFolder(e){let r={targetFoldersPaths:[e!=null?e:this.ctx.folderPath],groups:[],implicit:this.ctx.implicitSpec};return this.ctx.specs.push(r),this.ctx.currentSpec=void 0,this.ctx.currentSpecGroup=void 0,r}consumeParsedItemToHide(e){var r,o,n;if(((r=e.arraySpec)==null?void 0:r.length)===1){let i=e.arraySpec[0];if(!N(i)){let s=i.trim();if(s&&!Ho(s)&&this.ctx.currentSpec){let a=(n=(o=this.ctx.currentSpec)==null?void 0:o.itemsToHide)!=null?n:new Set;return a.add(s),this.ctx.currentSpec.itemsToHide=a,!0}}}return!1}};var Z=require("obsidian"),re="custom-sort-icon-active",tt="custom-sort-icon-mobile-initial",ke="custom-sort-icon-suspended",se="custom-sort-icon-enabled-not-applied",Ie="custom-sort-icon-syntax-error",rt="custom-sort-icon-general-error";function Lr(){(0,Z.addIcon)(re,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="currentColor"/>  
<path d="M 11.096126 32.678017 L 20.217128 18.949499 C 21.134003 17.56946 22.99602 17.193992 24.376058 18.110867 C 24.708624 18.331818 24.99374 18.616933 25.21469 18.949499 L 34.33569 32.678017 C 35.252567 34.058055 34.8771 35.92007 33.49706 36.836947 C 33.005085 37.163807 32.42757 37.338166 31.83691 37.338166 L 13.594907 37.338166 C 11.938053 37.338166 10.594907 35.99502 10.594907 34.338166 C 10.594907 33.747508 10.769266 33.16999 11.096126 32.678017 Z" fill="currentColor"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" fill="currentColor"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" fill="currentColor"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" fill="currentColor"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z"  fill="currentColor"/>`),(0,Z.addIcon)(tt,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="currentColor"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" fill="currentColor"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" fill="currentColor"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z"  fill="currentColor"/>`),(0,Z.addIcon)(ke,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" stroke="currentColor" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="currentColor" stroke-width="2" fill="none"/>`),(0,Z.addIcon)(Ie,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="red"/>  
<path d="M 11.096126 32.678017 L 20.217128 18.949499 C 21.134003 17.56946 22.99602 17.193992 24.376058 18.110867 C 24.708624 18.331818 24.99374 18.616933 25.21469 18.949499 L 34.33569 32.678017 C 35.252567 34.058055 34.8771 35.92007 33.49706 36.836947 C 33.005085 37.163807 32.42757 37.338166 31.83691 37.338166 L 13.594907 37.338166 C 11.938053 37.338166 10.594907 35.99502 10.594907 34.338166 C 10.594907 33.747508 10.769266 33.16999 11.096126 32.678017 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" fill="red"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z" fill="red"/>`),(0,Z.addIcon)(rt,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="red"/>  
<path d="M 11.096126 32.678017 L 20.217128 18.949499 C 21.134003 17.56946 22.99602 17.193992 24.376058 18.110867 C 24.708624 18.331818 24.99374 18.616933 25.21469 18.949499 L 34.33569 32.678017 C 35.252567 34.058055 34.8771 35.92007 33.49706 36.836947 C 33.005085 37.163807 32.42757 37.338166 31.83691 37.338166 L 13.594907 37.338166 C 11.938053 37.338166 10.594907 35.99502 10.594907 34.338166 C 10.594907 33.747508 10.769266 33.16999 11.096126 32.678017 Z" fill="red"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" fill="red"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" fill="red"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" fill="red"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z" fill="red"/>`),(0,Z.addIcon)(se,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" stroke="orange" stroke-width="2" fill="none"/>`)}var q=require("obsidian");var an="getBookmarks",Te="items",it=t=>{if(!t||(t==null?void 0:t.length)===0)return!0;for(let e of t)if(e.type!=="group"||!e.title||!H(e.title)||!it(e.items))return!1;return!0},vr=t=>it(t.items),nt=class{constructor(){this.determineBookmarkOrder=e=>{if(W||([W,de]=mn(this.plugin,this.groupNameForSorting),Oe=Date.now()),e&&e.length>0){let r=W==null?void 0:W[e];return r&&r>0?r:void 0}else return};this.bookmarkFolderItem=e=>{this.bookmarkSiblings([e],!0)};this.unbookmarkFolderItem=e=>{this.unbookmarkSiblings([e])};this.saveDataAndUpdateBookmarkViews=(e=!0)=>{if(this.plugin.onItemsChanged(!0),e){let r=app.workspace.getLeavesOfType("bookmarks");r==null||r.forEach(o=>{var n,i;(i=(n=o.view)==null?void 0:n.update)==null||i.call(n)})}};this.bookmarkSiblings=(e,r)=>{if(e.length===0)return;let o=V(e[0].path,Dr,this.plugin,this.groupNameForSorting);o&&e.forEach(n=>{let i=G(n.path),s=o.items.find(a=>a.type==="group"&&B(a.title||"")===i&&H(a.title));if(s)s.title=B(s.title||"");else if(!o.items.find(a=>(a.type==="folder"||a.type==="file")&&a.path===n.path||a.type==="group"&&a.title===i)){let a=n instanceof q.TFolder?Br(i):gn(n.path);r?o.items.unshift(a):o.items.push(a)}})};this.unbookmarkSiblings=e=>{if(e.length===0)return;let r=V(e[0].path,oe,this.plugin,this.groupNameForSorting);if(r){let o=[];e.forEach(n=>{let i=G(n.path),s=r.items.find(a=>a.type==="group"&&B(a.title||"")===i);if(s)vr(s)?(r.items.remove(s),X(r,this.plugin,this.groupNameForSorting)):H(s.title)||(s.title=Ae(s.title||""));else{let a=r.items.find(d=>(d.type==="folder"||d.type==="file")&&d.path===n.path);a&&(r.items.remove(a),X(r,this.plugin,this.groupNameForSorting))}})}};this.updateSortingBookmarksAfterItemRenamed=(e,r)=>{fn(this.plugin,e,r,this.groupNameForSorting)};this.updateSortingBookmarksAfterItemDeleted=e=>{pn(this.plugin,e,this.groupNameForSorting)};this.isBookmarkedForSorting=e=>{var o,n;let r=V(e.path,oe,this.plugin,this.groupNameForSorting);if(r){if(e instanceof q.TFile)return(o=r.items)==null?void 0:o.some(i=>i.type==="file"&&i.path===e.path);{let i=G(e.path);return(n=r.items)==null?void 0:n.some(s=>s.type==="group"&&s.title===i||s.type==="folder"&&s.path===e.path)}}return!1};this.bookmarksIncludeItemsInFolder=e=>!!(de!=null&&de[e])}},sn="bookmarks",P=(t,e,r)=>{var n;ln(e);let o=(n=app==null?void 0:app.internalPlugins)==null?void 0:n.getPluginById(sn);if(o&&o.enabled&&o.instance){let i=o.instance;if(typeof(i==null?void 0:i[an])=="function"&&Array.isArray(i==null?void 0:i[Te]))return Ce.plugin=i,Ce.groupNameForSorting=t,r&&!W&&Ce.determineBookmarkOrder(),Ce}},W,Oe,de,Ce=new nt,dn=1e3,ln=t=>{if(W){let e=!0;!t&&Oe&&Date.now()-dn<=Oe&&(e=!1),e&&(W=void 0,Oe=void 0,de=void 0)}},un=(t,e)=>{if(!Array.isArray(t))return;let r=(o,n)=>{if(Array.isArray(o))for(let i=0,s=o;i<s.length;i++){let a=s[i];if(e(a,n))return;if(a.type==="group"){let d=B(a.title||"");r(a.items,`${n}${n?"/":""}${d}`)}}};r(t,"")},Nr="#^-",cn="/",at="\\\\",H=t=>!!(t!=null&&t.startsWith(at)),Ae=t=>H(t)?t:`${at}${t}`,B=t=>H(t)?t.substring(at.length):t,mn=(t,e)=>{let r=t==null?void 0:t[Te],o={};if(r&&Array.isArray(r)){if(e){let n=r.find(i=>i.type==="group"&&i.title===e);r=n?n.items:void 0}if(r){let n={},i=1;un(r,(d,m)=>{if(d.type==="group"){if(!H(d.title)){let f=`${m}${m?"/":""}${d.title}`,u=n[f];if(u&&(u.isGroup||u.hasSortingIndicator))return;n[f]={path:f,order:i++,isGroup:!0}}}else if(d.type==="file"||d.type==="folder"){let f=d,u=d.type==="file"?d:void 0,l=n[f.path],c=u?u.subpath===Nr:void 0,p=z(f.path),F=m===p,O=!((m==null?void 0:m.length)>0);if(!F&&!O)return;if(l){if(c){if(l.hasSortingIndicator&&l.bookmarkPathMatches||l.hasSortingIndicator&&!F)return}else if(l.hasSortingIndicator||!F||l.bookmarkPathMatches||l.isGroup)return}n[f.path]={path:f.path,order:i++,isGroup:!1,bookmarkPathMatches:F,hasSortingIndicator:c}}});let a={};for(let d in n){a[d]=n[d].order;let m=z(d);o[m.length>0?m:cn]=!0}return[a,o]}}return[void 0,void 0]},gn=t=>({type:"file",ctime:Date.now(),path:t,subpath:Nr}),Br=t=>({type:"group",ctime:Date.now(),items:[],title:t}),V=(t,e,r,o)=>{let n=r==null?void 0:r[Te];if(!Array.isArray(n)||!t||!t.trim())return;let i=z(t),s=i?i.split("/"):[];o&&s.unshift(o);let a,d=!1,m=!0;for(let f of s){if(a=n.find(u=>u.type==="group"&&B(u.title||"")===f),!a){if(e){let l=!!o&&m?f:Ae(f);a=Br(l),n.push(a)}else{d=!0;break}m=!1}n=a.items}if(!d)return{items:n,group:a,pathOfGroup:i}},Dr=!0,oe=!1,ot=(t,e,r)=>{r===!0?t.title=Ae(e):r===!1?t.title=e:t.title=H(t.title)?Ae(e):e},X=(t,e,r)=>{var o,n;if(t&&t.group&&it(t.items)){t.group.items=[];let i=V(t.pathOfGroup||"",oe,e,r);i&&(H(t.group.title)&&((n=(o=i.group)==null?void 0:o.items)==null||n.remove(t.group)),X(i,e,r))}},fn=(t,e,r,o)=>{var p,F,O,A;if(e.path===r)return;let n=e instanceof q.TFolder,i=!n,s=z(r),a=G(r),d=z(e.path),m=G(e.path),f=s!==d,u=a!==m;if(i&&u)return;let l=V(r,oe,t,o);if(!l)return;let c=n?l.items.find(h=>h.type==="group"&&B(h.title||"")===a):l.items.find(h=>h.type==="file"&&h.path===e.path);if(c)if(i)f&&((p=l.group)==null||p.items.remove(c),X(l,t,o));else{let h=c;if(vr(h))f?((F=l.group)==null||F.items.remove(h),X(l,t,o)):u&&ot(h,m,void 0);else{if(f){(O=l.group)==null||O.items.remove(h);let D=V(e.path,Dr,t,o);D&&((A=D.group)==null||A.items.push(h),ot(h,B(h.title||""),!0)),X(l,t,o)}u&&ot(h,m,void 0)}}},pn=(t,e,r)=>{if(e instanceof q.TFile)return;let o=t[Te];if(!Array.isArray(o))return;let n=e instanceof q.TFolder,i=!n,s=V(e.path,oe,t,r),a=!!z(e.path),d=r&&!a?V("intentionally-in-root-path",oe,t,r):void 0;!s&&!d||[s,d].forEach(m=>{let f=[];m==null||m.items.forEach(u=>{n&&u.type==="group"&&B(u.title||"")===e.name&&f.push(u),i&&u.type==="file"&&u.path===e.path&&f.push(u)}),f.forEach(u=>{var l;(l=m==null?void 0:m.group)==null||l.items.remove(u)}),X(m,t,r)})};var _r=`
target-folder: /*
bookmarked:
  < by-bookmarks-order
sorting: standard
`,hn=(t,e,r)=>{r===8&&t.grouping.byBookmarks++,(e===18||e===19)&&t.sorting.byBookmarks++},bn=(t,e,r)=>{r===7&&t.grouping.byStarred++},Sn=(t,e,r)=>{r===9&&t.grouping.byIcon++},xn=(t,e,r)=>{e===17&&t.sorting.standardObsidian++},Pe=(t,e,r)=>{hn(t,e,r),bn(t,e,r),Sn(t,e,r),xn(t,e,r),e!==void 0&&t.sorting.total++,r!==void 0&&r!==0&&t.grouping.total++},st=t=>{let e={grouping:{byIcon:0,byStarred:0,byBookmarks:0,total:0},sorting:{byBookmarks:0,standardObsidian:0,total:0}};if(!t)return e;if(Pe(e,t.defaultOrder),Pe(e,t.defaultSecondaryOrder),t.groups)for(let r of t.groups)Pe(e,r.order,r.type),Pe(e,r.secondaryOrder);return e},wr=t=>t.sorting.total===t.sorting.standardObsidian+t.sorting.byBookmarks&&t.grouping.total===t.grouping.byBookmarks;var Vr={additionalSortspecFile:"",suspended:!0,statusBarEntryEnabled:!0,notificationsEnabled:!0,mobileNotificationsEnabled:!1,customSortContextSubmenu:!0,automaticBookmarksIntegration:!1,bookmarksContextMenus:!1,bookmarksGroupToConsumeAsOrderingReference:"sortspec"},Fn={automaticBookmarksIntegration:!0,bookmarksContextMenus:!0},Gr="sortspec.md",Wr="sorting-spec",yn=1e4,Re=class extends b.Plugin{showNotice(r,o){(this.settings.notificationsEnabled||b.Platform.isMobile&&this.settings.mobileNotificationsEnabled)&&new b.Notice(r,o)}readAndParseSortingSpec(){let r=app.metadataCache,o=!1,n=!1,i=null;this.sortSpecCache=null;let s=new ye;this.settings.automaticBookmarksIntegration&&(this.sortSpecCache=s.parseSortSpecFromText(_r.split(`
`),"System internal path","System internal file",this.sortSpecCache,!0)),b.Vault.recurseChildren(app.vault.getRoot(),a=>{var d,m,f;if(!o&&a instanceof b.TFile){let u=a,l=u.parent;if(u.name===Gr||u.name===`${Gr}.md`||u.basename===l.name||u.basename===this.settings.additionalSortspecFile||u.name===this.settings.additionalSortspecFile||u.path===this.settings.additionalSortspecFile||u.path===`${this.settings.additionalSortspecFile}.md`){let c=(m=(d=r.getCache(u.path))==null?void 0:d.frontmatter)==null?void 0:m[Wr];c&&(n=!0,this.sortSpecCache=s.parseSortSpecFromText(c.split(`
`),l.path,u.name,this.sortSpecCache),this.sortSpecCache===null&&(o=!0,i=(f=s.recentErrorMessage)!=null?f:""))}}}),this.sortSpecCache?this.showNotice("Parsing custom sorting specification SUCCEEDED!"):(n?i=i||`No valid '${Wr}:' key(s) in YAML front matter or multiline YAML indentation error or general YAML syntax error`:i="No custom sorting specification found or only empty specification(s)",this.showNotice(`Parsing custom sorting specification FAILED. Suspending the plugin.
${i}`,yn),this.settings.suspended=!0,this.saveSettings())}checkFileExplorerIsAvailableAndPatchable(r=!0){let o=this.getFileExplorer();if(o&&typeof o.createFolderDom=="function"&&typeof o.requestSort=="function")return o;r&&this.logWarningFileExplorerNotAvailable()}logWarningFileExplorerNotAvailable(){let r=`custom-sort v${this.manifest.version}: failed to locate File Explorer. The 'Files' core plugin can be disabled.
Some community plugins can also disable it.
See the example of MAKE.md plugin: https://github.com/Make-md/makemd/issues/25
You can find there instructions on how to re-enable the File Explorer in MAKE.md plugin`;console.warn(r)}switchPluginStateTo(r,o=!0){let n=this.checkFileExplorerIsAvailableAndPatchable();n&&!this.fileExplorerFolderPatched&&(this.fileExplorerFolderPatched=this.patchFileExplorerFolder(n),this.fileExplorerFolderPatched||(n=void 0)),this.settings.suspended=!r,this.saveSettings();let i;this.settings.suspended?(this.showNotice("Custom sort OFF"),this.sortSpecCache=null,i=ke):(this.readAndParseSortingSpec(),this.sortSpecCache?n?(this.showNotice("Custom sort ON"),this.initialAutoOrManualSortingTriggered=!0,i=re):(this.showNotice("Custom sort GENERAL PROBLEM. See console for detailed message."),i=rt,this.settings.suspended=!0,this.saveSettings()):(i=Ie,this.settings.suspended=!0,this.saveSettings()));let s=!0;this.settings.suspended||P(this.settings.bookmarksGroupToConsumeAsOrderingReference,s),n?this.fileExplorerFolderPatched&&n.requestSort():i===re&&(i=se,o&&(this.ribbonIconStateInaccurate=!0)),o&&(0,b.setIcon)(this.ribbonIconEl,i),this.updateStatusBar()}async onload(){console.log(`loading custom-sort v${this.manifest.version}`),await this.loadSettings(),this.settings.statusBarEntryEnabled&&(this.statusBarItemEl=this.addStatusBarItem(),this.updateStatusBar()),Lr(),this.ribbonIconEl=this.addRibbonIcon(b.Platform.isDesktop?this.settings.suspended?ke:se:tt,"Toggle custom sorting",r=>{this.switchPluginStateTo(this.settings.suspended)}),this.settings.suspended||(this.ribbonIconStateInaccurate=!0),this.addSettingTab(new dt(app,this)),this.registerEventHandlers(),this.registerCommands(),this.initialize()}registerEventHandlers(){let r=this,o=b.Platform.isMobile;this.registerEvent(app.metadataCache.on("resolved",()=>{if(!this.settings.suspended&&!this.initialAutoOrManualSortingTriggered)if(this.readAndParseSortingSpec(),this.initialAutoOrManualSortingTriggered=!0,this.sortSpecCache){this.showNotice("Custom sort ON");let l=this.checkFileExplorerIsAvailableAndPatchable(!1);l?((0,b.setIcon)(this.ribbonIconEl,re),l.requestSort()):((0,b.setIcon)(this.ribbonIconEl,se),r.ribbonIconStateInaccurate=!0),this.updateStatusBar()}else this.settings.suspended=!0,(0,b.setIcon)(this.ribbonIconEl,Ie),this.saveSettings()}));let n=l=>{l.setTitle(o?"Custom sort: apply custom sorting":"Apply custom sorting"),l.onClick(()=>{r.switchPluginStateTo(!0,!0)})},i=l=>{l.setTitle(o?"Custom sort: suspend custom sorting":"Suspend custom sorting"),l.onClick(()=>{r.switchPluginStateTo(!1,!0)})},s=l=>c=>{c.setTitle(o?"Bookmark it for custom sorting":"Bookmark it for sorting"),c.onClick(()=>{let p=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);p&&(p.bookmarkFolderItem(l),p.saveDataAndUpdateBookmarkViews(!0))})},a=l=>c=>{c.setTitle(o?"UNbookmark it from custom sorting":"UNbookmark it from sorting"),c.onClick(()=>{let p=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);p&&(p.unbookmarkFolderItem(l),p.saveDataAndUpdateBookmarkViews(!0))})},d=l=>c=>{c.setTitle(o?"Bookmark it+siblings for custom sorting":"Bookmark it+siblings for sorting"),c.onClick(()=>{let p=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);if(p){let F=r.orderedFolderItemsForBookmarking(l.parent,p);p.bookmarkSiblings(F),p.saveDataAndUpdateBookmarkViews(!0)}})},m=l=>c=>{c.setTitle(o?"UNbookmark it+siblings from custom sorting":"UNbookmark it+siblings from sorting"),c.onClick(()=>{let p=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);if(p){let F=l.parent.children.map(O=>O);p.unbookmarkSiblings(F),p.saveDataAndUpdateBookmarkViews(!0)}})},f=l=>c=>{c.setTitle(o?"Bookmark selected for custom sorting":"Custom sort: bookmark selected for sorting"),c.onClick(()=>{let p=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);p&&(l.forEach(F=>{p.bookmarkFolderItem(F)}),p.saveDataAndUpdateBookmarkViews(!0))})},u=l=>c=>{c.setTitle(o?"UNbookmark selected from custom sorting":"Custom sort: UNbookmark selected from sorting"),c.onClick(()=>{let p=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);p&&(l.forEach(F=>{p.unbookmarkFolderItem(F)}),p.saveDataAndUpdateBookmarkViews(!0))})};this.registerEvent(app.workspace.on("file-menu",(l,c,p,F)=>{if(!this.settings.customSortContextSubmenu)return;let O=A=>{let h;if(A&&(A.setTitle("Custom sort:"),A.setIcon("hashtag"),h=A.setSubmenu()),h||l.addSeparator(),(h!=null?h:l).addItem(n),h&&h.addSeparator(),this.settings.bookmarksContextMenus){let D=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);D&&(D.isBookmarkedForSorting(c)?(h!=null?h:l).addItem(a(c)):(h!=null?h:l).addItem(s(c)),(h!=null?h:l).addItem(d(c)),(h!=null?h:l).addItem(m(c)))}(h!=null?h:l).addItem(i)};o?O(void 0):l.addItem(O)})),(0,b.requireApiVersion)("1.4.11")&&this.registerEvent(app.workspace.on("files-menu",(l,c,p,F)=>{if(!this.settings.customSortContextSubmenu)return;let O=A=>{let h;A&&(A.setTitle("Custom sort:"),A.setIcon("hashtag"),h=A.setSubmenu()),h||l.addSeparator(),(h!=null?h:l).addItem(n),h&&h.addSeparator(),this.settings.bookmarksContextMenus&&P(r.settings.bookmarksGroupToConsumeAsOrderingReference)&&((h!=null?h:l).addItem(f(c)),(h!=null?h:l).addItem(u(c))),(h!=null?h:l).addItem(i)};o?O(void 0):l.addItem(O)})),this.registerEvent(app.vault.on("rename",(l,c)=>{let p=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);p&&(p.updateSortingBookmarksAfterItemRenamed(l,c),p.saveDataAndUpdateBookmarkViews(!0))})),app.vault.on("delete",l=>{let c=P(r.settings.bookmarksGroupToConsumeAsOrderingReference);c&&(c.updateSortingBookmarksAfterItemDeleted(l),c.saveDataAndUpdateBookmarkViews(!0))})}registerCommands(){let r=this;this.addCommand({id:"enable-custom-sorting",name:"Enable and apply the custom sorting, (re)parsing the sorting configuration first. Sort-on.",callback:()=>{r.switchPluginStateTo(!0,!0)}}),this.addCommand({id:"suspend-custom-sorting",name:"Suspend the custom sorting. Sort-off.",callback:()=>{r.switchPluginStateTo(!1,!0)}})}initialize(){app.workspace.onLayoutReady(()=>{this.fileExplorerFolderPatched=this.patchFileExplorerFolder()})}determineSortSpecForFolder(r,o){var i,s,a,d,m,f;o=o!=null?o:G(r);let n=(s=(i=this.sortSpecCache)==null?void 0:i.sortSpecByPath)==null?void 0:s[r];return n=n!=null?n:(d=(a=this.sortSpecCache)==null?void 0:a.sortSpecByName)==null?void 0:d[o],!n&&((m=this.sortSpecCache)!=null&&m.sortSpecByWildcard)&&(n=(f=this.sortSpecCache)==null?void 0:f.sortSpecByWildcard.folderMatch(r,o)),n}createProcessingContextForSorting(r){return{_mCache:app.metadataCache,starredPluginInstance:r.grouping.byStarred?ft():void 0,bookmarksPluginInstance:r.grouping.byBookmarks||r.sorting.byBookmarks?P(this.settings.bookmarksGroupToConsumeAsOrderingReference,!1,!0):void 0,iconFolderPluginInstance:r.grouping.byIcon?St():void 0,plugin:this}}patchFileExplorerFolder(r){let o=this;if(r=r!=null?r:this.checkFileExplorerIsAvailableAndPatchable(!1),r){let n=new b.TFolder(b.Vault,""),i=r.createFolderDom(n).constructor,s=gt(i.prototype,{sort(a){return function(...d){if(o.settings.suspended)return a.call(this,...d);o.ribbonIconStateInaccurate&&o.ribbonIconEl&&(o.ribbonIconStateInaccurate=!1,(0,b.setIcon)(o.ribbonIconEl,re));let m=this.file,f=o.determineSortSpecForFolder(m.path,m.name),u=st(f);if(wr(u)){let l=P(o.settings.bookmarksGroupToConsumeAsOrderingReference,!1,!0);l!=null&&l.bookmarksIncludeItemsInFolder(m.path)||(f=null)}return f?Gt.call(this,f,o.createProcessingContextForSorting(u)):a.call(this,...d)}}});return this.register(s),!0}else return!1}orderedFolderItemsForBookmarking(r,o){var a;let n;this.settings.suspended||(n=this.determineSortSpecForFolder(r.path,r.name));let i=((a=this.getFileExplorer())==null?void 0:a.sortOrder)||Et,s=st(n);return Wt(r,r.children,n,this.createProcessingContextForSorting(s),i)}getFileExplorer(){var o,n;return(n=(o=app.workspace.getLeavesOfType("file-explorer"))==null?void 0:o.first())==null?void 0:n.view}onunload(){}updateStatusBar(){this.statusBarItemEl&&this.statusBarItemEl.setText(`Custom sort:${this.settings.suspended?"OFF":"ON"}`)}async loadSettings(){let r=await this.loadData()||{},o=Object.keys(r).length===0;this.settings=Object.assign({},Vr,r),(0,b.requireApiVersion)("1.2.0")&&(this.settings=Object.assign(this.settings,Fn))}async saveSettings(){await this.saveData(this.settings)}},kn=t=>t.replace(/\//g,"_").replace(/\\/g,"_"),dt=class extends b.PluginSettingTab{constructor(r,o){super(r,o);this.plugin=o}display(){let{containerEl:r}=this;r.empty();let o=(0,b.sanitizeHTMLToDom)('A note name or note path to scan (YAML frontmatter) for sorting specification in addition to the `sortspec` notes and Folder Notes<sup><b>*</b></sup>.<br> The `.md` filename suffix is optional.<p><b>(*)</b>&nbsp;if you employ the <i>Index-File based</i> approach to folder notes (as documented in <a href="https://github.com/aidenlx/alx-folder-note/wiki/folder-note-pref">Aidenlx Folder Note preferences</a>) you can enter here the index note name, e.g. <b>_about_</b><br>The <i>Inside Folder, with Same Name Recommended</i> mode of Folder Notes is handled automatically, no additional configuration needed.</p><p>NOTE: After updating this setting remember to refresh the custom sorting via clicking on the ribbon icon or via the <b>sort-on</b> command or by restarting Obsidian or reloading the vault</p>');new b.Setting(r).setName("Path or name of additional note(s) containing sorting specification").setDesc(o).addText(s=>s.setPlaceholder("e.g. _about_").setValue(this.plugin.settings.additionalSortspecFile).onChange(async a=>{this.plugin.settings.additionalSortspecFile=a.trim()?(0,b.normalizePath)(a):"",await this.plugin.saveSettings()})),new b.Setting(r).setName("Enable the status bar entry").setDesc("The status bar entry shows the label `Custom sort:ON` or `Custom sort:OFF`, representing the current state of the plugin.").addToggle(s=>s.setValue(this.plugin.settings.statusBarEntryEnabled).onChange(async a=>{this.plugin.settings.statusBarEntryEnabled=a,a?(this.plugin.statusBarItemEl&&this.plugin.statusBarItemEl.detach(),this.plugin.statusBarItemEl=this.plugin.addStatusBarItem(),this.plugin.updateStatusBar()):this.plugin.statusBarItemEl&&this.plugin.statusBarItemEl.detach(),await this.plugin.saveSettings()})),new b.Setting(r).setName("Enable notifications of plugin state changes").setDesc("The plugin can show notifications about its state changes: e.g. when successfully parsed and applied the custom sorting specification, or, when the parsing failed. If the notifications are disabled, the only indicator of plugin state is the ribbon button icon. The developer console presents the parsing error messages regardless if the notifications are enabled or not.").addToggle(s=>s.setValue(this.plugin.settings.notificationsEnabled).onChange(async a=>{this.plugin.settings.notificationsEnabled=a,await this.plugin.saveSettings()})),new b.Setting(r).setName("Enable notifications of plugin state changes for mobile devices only").setDesc("See above.").addToggle(s=>s.setValue(this.plugin.settings.mobileNotificationsEnabled).onChange(async a=>{this.plugin.settings.mobileNotificationsEnabled=a,await this.plugin.saveSettings()})),new b.Setting(r).setName("Enable File Explorer context submenu`Custom sort:`").setDesc("Gives access to operations relevant for custom sorting, e.g. applying custom sorting.").addToggle(s=>s.setValue(this.plugin.settings.customSortContextSubmenu).onChange(async a=>{this.plugin.settings.customSortContextSubmenu=a,await this.plugin.saveSettings()})),r.createEl("h2",{text:"Bookmarks integration"});let n=(0,b.sanitizeHTMLToDom)(`If enabled, order of files and folders in File Explorer will reflect the order of bookmarked items in the bookmarks (core plugin) view. Automatically, without any need for sorting configuration. At the same time, it integrates seamlessly with <pre style="display: inline;">sorting-spec:</pre> configurations and they can nicely cooperate.<br><p>To separate regular bookmarks from the bookmarks created for sorting, you can put the latter in a separate dedicated bookmarks group. The default name of the group is '<i>`+Vr.bookmarksGroupToConsumeAsOrderingReference+`</i>' and you can change the group name in the configuration field below.<br>If left empty, all the bookmarked items will be used to impose the order in File Explorer.</p><p>More information on this functionality in the <a href="https://github.com/SebastianMC/obsidian-custom-sort/blob/master/docs/manual.md#bookmarks-plugin-integration">manual</a> of this custom-sort plugin.</p>`);new b.Setting(r).setName("Automatic integration with core Bookmarks plugin (for indirect drag & drop ordering)").setDesc(n).addToggle(s=>s.setValue(this.plugin.settings.automaticBookmarksIntegration).onChange(async a=>{this.plugin.settings.automaticBookmarksIntegration=a,await this.plugin.saveSettings()})),new b.Setting(r).setName("Name of the group in Bookmarks from which to read the order of items").setDesc("See above.").addText(s=>s.setPlaceholder("e.g. Group for sorting").setValue(this.plugin.settings.bookmarksGroupToConsumeAsOrderingReference).onChange(async a=>{a=B(a.trim()).trim(),this.plugin.settings.bookmarksGroupToConsumeAsOrderingReference=a?kn((0,b.normalizePath)(a)):"",await this.plugin.saveSettings()}));let i=(0,b.sanitizeHTMLToDom)("Enable <i>Custom-sort: bookmark for sorting</i> and <i>Custom-sort: bookmark+siblings for sorting</i> (and related) entries in context menu in File Explorer");new b.Setting(r).setName("Context menus for Bookmarks integration").setDesc(i).addToggle(s=>s.setValue(this.plugin.settings.bookmarksContextMenus).onChange(async a=>{this.plugin.settings.bookmarksContextMenus=a,a&&(this.plugin.settings.customSortContextSubmenu=!0),await this.plugin.saveSettings()}))}};
